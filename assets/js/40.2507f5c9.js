(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{328:function(t,s,e){"use strict";e.r(s);var n=e(10),a=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"正式安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#正式安装"}},[t._v("#")]),t._v(" 正式安装")]),t._v(" "),s("h3",{attrs:{id:"_1、环境准备"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、环境准备"}},[t._v("#")]),t._v(" 1、环境准备")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 分别在三个主机上设置主机名，重启生效")]),t._v("\nhostnamectl set-hostname master\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("reboot")]),t._v("\n\nhostnamectl set-hostname node1\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("reboot")]),t._v("\n\nhostnamectl set-hostname node2\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("reboot")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置免登录(在master上运行) 仅仅是为了复制文件方便 可以不操作")]),t._v("\nssh-keygen\nssh-copy-id root@node01\nssh-copy-id root@node02\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#把hosts文件复制到node01\\02(在msster上运行)")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("scp")]),t._v(" /etc/hosts root@node01:/etc/hosts\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("scp")]),t._v(" /etc/hosts root@node02:/etc/hosts\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 关闭防火墙和iptables")]),t._v("\nsystemctl stop firewalld.service\nsystemctl disable firewalld.service\nsystemctl stop iptables.service\nsystemctl disable iptables.service\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#关闭防火墙(在3台机运行)")]),t._v("\nsystemctl stop firewalld "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" systemctl disable firewalld\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#关闭selinux(在3台机运行)")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s/enforcing/disabled/'")]),t._v(" /etc/selinux/config "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" setenforce "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#关闭swap(在3台机运行)")]),t._v("\nswapoff "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-ri")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s/.*swap.*/#&/'")]),t._v(" /etc/fstab\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#时间同步(在3台机运行)")]),t._v("\nyum "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" ntpdate "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" timedatectl set-timezone Asia/Shanghai  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" ntpdate time.windows.com\n")])])]),s("blockquote",[s("p",[s("span",{staticStyle:{color:"red"}},[t._v(" 如果私有ip不通，存在公网ip的云服务器,建立虚拟网卡")])])]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# step1 ，注意替换你的公网IP进去")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /etc/sysconfig/network-scripts/ifcfg-eth0:1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("EOF\nBOOTPROTO=static\nDEVICE=eth0:1\nIPADDR=你的公网IP\nPREFIX=32\nTYPE=Ethernet\nUSERCTL=no\nONBOOT=yes\nEOF")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# step2 如果是centos8，需要重启）（建议直接换成centos7，centos8的网卡设置复杂一些）")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 华为云服务器在网卡设置上是默认了有eth1-eth5 所以需要把默认的这些全部取消 不然会抛错导致网卡无法重启")]),t._v("\nsystemctl restart network\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# step3 查看新建的IP是否进去")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ip")]),t._v(" addr\n")])])]),s("h3",{attrs:{id:"_2、安装docker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、安装docker"}},[t._v("#")]),t._v(" 2、安装Docker")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# step 1: 安装必要的一些系统工具")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" yum "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" yum-utils device-mapper-persistent-data lvm2\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Step 2: 添加软件源信息")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Step 3: 更新并安装Docker-CE")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" yum makecache fast\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" yum "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" docker-ce\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Step 4: 开启Docker服务")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl start "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" systemctl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 注意：")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 官方软件源默认启用了最新的软件，您可以通过编辑软件源的方式获取各个版本的软件包。例如官方并没有将测试版本的软件源置为可用，您可以通过以下方式开启。同理可以开启各种测试版本等。")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vim /etc/yum.repos.d/docker-ee.repo")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   将[docker-ce-test]下方的enabled=0修改为enabled=1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装指定版本的Docker-CE:")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Step 1: 查找Docker-CE的版本:")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# yum list docker-ce.x86_64 --showduplicates | sort -r")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   Loading mirror speeds from cached hostfile")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   Loaded plugins: branch, fastestmirror, langpacks")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   docker-ce.x86_64            17.03.1.ce-1.el7.centos            docker-ce-stable")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   docker-ce.x86_64            17.03.1.ce-1.el7.centos            @docker-ce-stable")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   docker-ce.x86_64            17.03.0.ce-1.el7.centos            docker-ce-stable")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   Available Packages")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Step2: 安装指定版本的Docker-CE: (VERSION例如上面的17.03.0.ce.1-1.el7.centos)")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sudo yum -y install docker-ce-[VERSION]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# docker镜像加速，"https://s2q9fn53.mirror.aliyuncs.com"这个地址建议自己登陆阿里云，在容器镜像服务中找到。')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可以通过修改daemon配置文件/etc/docker/daemon.json来使用加速器")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" /etc/docker\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tee")]),t._v(" /etc/docker/daemon.json "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<-")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'EOF\'\n{\n  "exec-opts": ["native.cgroupdriver=systemd"],\n  "registry-mirrors": ["https://s2q9fn53.mirror.aliyuncs.com"]\n}\nEOF')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl daemon-reload "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl restart "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v("\n")])])]),s("h3",{attrs:{id:"_3、安装kubelet、kubeadm、kubectl"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、安装kubelet、kubeadm、kubectl"}},[t._v("#")]),t._v(" 3、安装kubelet、kubeadm、kubectl")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#添加kubernetes阿里YUM源")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("EOF"),s("span",{pre:!0,attrs:{class:"token bash punctuation"}},[t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /etc/yum.repos.d/kubernetes.repo")]),t._v("\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/\nenabled=1\ngpgcheck=1\nrepo_gpgcheck=1\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装 或者指定版本")]),t._v("\nyum "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" kubelet kubeadm kubectl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" systemctl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v(" kubelet "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" systemctl start kubelet\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# yum install -y kubelet-1.19.4 kubeadm-1.19.4 kubectl-1.19.4 && systemctl enable kubelet && systemctl start kubelet")]),t._v("\n\n")])])]),s("h3",{attrs:{id:"_4、部署kubernetes-master"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4、部署kubernetes-master"}},[t._v("#")]),t._v(" 4、部署Kubernetes Master")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#注意，kubeadm init 前,先准备k8s运行所需的容器")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#可查询到kubernetes所需镜像")]),t._v("\nkubeadm config images list\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#写了个sh脚本，把所需的镜像拉下来")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" alik8simages.sh "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("EOF\n#!/bin/bash\nlist='kube-apiserver:v1.19.4\nkube-controller-manager:v1.19.4\nkube-scheduler:v1.19.4\nkube-proxy:v1.19.4\npause:3.2\netcd:3.4.13-0\ncoredns:1.7.0'\nfor item in \\"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$list")]),t._v("\n  do\n\n    docker pull registry.aliyuncs.com/google_containers/\\"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$item")]),t._v(" && docker tag registry.aliyuncs.com/google_containers/\\"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$item")]),t._v(" k8s.gcr.io/\\"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$item")]),t._v(" && docker rmi registry.aliyuncs.com/google_containers/\\"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$item")]),t._v("\n\n  done\nEOF")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#运行脚本下载")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v(" alik8simages.sh\n\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#初始化k8s集群")]),t._v("\nkubeadm init "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--apiserver-advertise-address"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.200 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--kubernetes-version"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("v1.19.4 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--service-cidr"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.96")]),t._v(".0.0/12 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--pod-network-cidr"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".0.0/16\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#提示initialized successfully!表示初始化成功")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##注意提示：to start using you cluster,you need to run the following as a regular user:")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("chown")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#按提示执行以上三条命令")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#执行完后可以运行,查看node节点情况")]),t._v("\nkubectl get nodes\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#还有一条提示：")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#then you can join any number of worker nodes by running the following on each as root")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#翻译：然后，您可以通过在每个worker节点上以root身份运行以下命令来连接任意数量的worker节点")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#接着把提示如下的语句复制到node节点运行")]),t._v("\nkubeadm "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.200:6443 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--token")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n\n")])])]),s("h3",{attrs:{id:"_5、应用网络插件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5、应用网络插件"}},[t._v("#")]),t._v(" 5、应用网络插件")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml\n")])])]),s("h3",{attrs:{id:"_6、节点加入集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6、节点加入集群"}},[t._v("#")]),t._v(" 6、节点加入集群")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node1 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubeadm join 192.168.0.46:6443 --token b2n16t.n6filxh3vc6byr7c \\")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("         --discovery-token-ca-cert-hash sha256:f4d103707658df3fa7a8dc95a59719f362cd42edb40c8ebc5ae19d53655813d1\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Running pre-flight checks\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Reading configuration from the cluster"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" FYI: You can "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("look")]),t._v(" at this config "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" with "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kubectl -n kube-system get cm kubeadm-config -o yaml'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Writing kubelet configuration to "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/lib/kubelet/config.yaml"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Writing kubelet environment "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" with flags to "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/lib/kubelet/kubeadm-flags.env"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Starting the kubelet\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Waiting "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" the kubelet to perform the TLS Bootstrap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n\nThis "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v(" has joined the cluster:\n* Certificate signing request was sent to apiserver and a response was received.\n* The Kubelet was informed of the new secure connection details.\n\nRun "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kubectl get nodes'")]),t._v(" on the control-plane to see this "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),t._v(" the cluster.\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node1 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n\n")])])]),s("blockquote",[s("p",[t._v("如果想在节点上执行kubectl命令，则需要将master节点配置拷贝至节点的$HOME/.kube目录下。")])]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#在节点上创建一个目录，即kubectl默认启动读取证书配置目录")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node1 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mkdir -p $HOME/.kube")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#在master节点将配置复制到node1节点")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# scp .kube/config root@node1:/root/.kube/")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#可在node节点查看节点，组件，pod等状态")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node1 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get nodes")]),t._v("\nNAME     STATUS   ROLES                  AGE   VERSION\nmaster   Ready    control-plane,master   43m   v1.23.1\nnode1    Ready    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("                 39m   v1.23.1\nnode2    Ready    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("                 39m   v1.23.1\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node1 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get ns")]),t._v("\nNAME              STATUS   AGE\ndefault           Active   43m\nkube-node-lease   Active   43m\nkube-public       Active   43m\nkube-system       Active   43m\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node1 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get cs")]),t._v("\nWarning: v1 ComponentStatus is deprecated "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" v1.19+\nNAME                 STATUS    MESSAGE                         ERROR\nscheduler            Healthy   ok\ncontroller-manager   Healthy   ok\netcd-0               Healthy   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"health"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"reason"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node1 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods -nkube-system")]),t._v("\nNAME                             READY   STATUS    RESTARTS   AGE\ncoredns-64897985d-bs6b9          "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          43m\ncoredns-64897985d-s2kml          "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          43m\netcd-master                      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          44m\nkube-apiserver-master            "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          44m\nkube-controller-manager-master   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          44m\nkube-flannel-ds-8jpd4            "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          39m\nkube-flannel-ds-jlfzx            "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          39m\nkube-flannel-ds-jztwk            "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          41m\nkube-proxy-5lnr9                 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          39m\nkube-proxy-thghs                 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          43m\nkube-proxy-w7rhv                 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          39m\nkube-scheduler-master            "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          44m\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node1 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n\n")])])]),s("h2",{attrs:{id:"参考文章"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[t._v("#")]),t._v(" 参考文章")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://segmentfault.com/a/1190000041143220",target:"_blank",rel:"noopener noreferrer"}},[t._v("使用Kubeadm在华为云上搭建V1.23.1版本Kubernetes"),s("OutboundLink")],1),t._v(" "),s("a",{attrs:{href:"https://segmentfault.com/a/1190000040043530",target:"_blank",rel:"noopener noreferrer"}},[t._v("华为云+阿里云 不同云服务器部署Kubernetes(K8S)"),s("OutboundLink")],1),t._v(" "),s("a",{attrs:{href:"https://github.com/sskcal/kubernetes",target:"_blank",rel:"noopener noreferrer"}},[t._v("github"),s("OutboundLink")],1),t._v(" "),s("a",{attrs:{href:"https://www.cnblogs.com/yunweiadmin/p/10441724.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("kubelet常见问题处解决"),s("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=a.exports}}]);